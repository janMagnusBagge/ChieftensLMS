@model int?

@{
	ViewBag.Title = "Kurs - Delade filer";
}

<h2>Kurs - Delade Filer</h2>
<div ng-controller="sharedFileForCourseController" ng-init="GetForCourse(@Model)">

	<table class="table">
		<tr>
			<th>Namn</th>
			<th>Ägare</th>
			<th>Datum</th>
			<th></th>
			<th></th>
		</tr>
		<tr ng-repeat="file in apiData.SharedFiles">
			<td>{{file.Name}}</td>
			<td>{{file.OwnerId != apiData.UserId ? file.OwnerName : "Du" }}</td>
			<td>{{file.Date | dateFilter | date:'yyyy-MM-dd'}}</td>
			
			<td><a href="~/SharedFileApi/Download/{{file.Id}}" class="btn btn-success btn-sm">Ladda ner</a> <button type="button" class="btn btn-danger btn-sm" ng-click="Delete(file.Id)" ng-show="file.Owner==null">Radera</button></td>
		</tr>
	</table>

</div>


@section scripts {
	<script>

	(function () {
		angular.module("app").controller("sharedFileForCourseController", function ($scope, ApiService) {
			$scope.apiData = {};

			var onSuccess = function (data) {
				$scope.apiData = data;
			};

			var onFail = function (response) {
				alert(response.Reason);
			};

			var onDeleteSuccess = function (data) {
				var index = -1;
				for (var i = 0; i < $scope.apiData.sharedFiles.length; i++) {
					if ($scope.apiData.sharedFiles[i].Id == data.Id) {
						index = i;
						break;
					}
				}

				if (index != -1)
					$scope.apiData.sharedFiles.splice(index, 1);
			};

			var onDeleteFail = function (response) {
				alert(response.Reason);
			};

			$scope.GetForCourse = function (id)
			{
				ApiService.Get("/SharedFileApi/ForCourse", onSuccess, onFail, { id: id });
			}

			$scope.Delete = function (id) {
				ApiService.Get("/SharedFileApi/Delete", onDeleteSuccess, onDeleteFail, { id: id });
			}

		});

	}());

	</script>
}